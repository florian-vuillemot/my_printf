/*
** replace_star_and_dollar.c for  in /home/vuille_f/PSU_2015_my_printf/list_va_arg
** 
** Made by Florian Vuillemot
** Login   <vuille_f@epitech.net>
** 
** Started on  Sat Nov 14 13:07:45 2015 Florian Vuillemot
** Last update Sat Nov 14 13:34:11 2015 Florian Vuillemot
*/

#include		"list_va_arg.h"

static t_string		*check_dollar(t_string *string, t_list_va_arg *arg,
				      unsigned int i)
{
  int			nb;
  char			*str;

  if (!string || !arg)
    return (NULL);
  if ((nb = my_getnbr(string->string + i)) < 0)
    return (string);
  if ((str = get_index_arg(arg, nb)) == NULL)
    return (string);
  if ((string = insert_string(string, str, i)) == NULL)
    return (NULL);
  i += my_strlen(str);
  while (string && ((string->string[i] <= '9' && string->string[i] >= '0')
		    || string->string[i] == '$'))
    string = remove_elem_to_string(string, i);
  return (string);
}

t_string		*replace_star_and_dollar(t_string *string,
						 t_list_va_arg *arg)
{
  unsigned int		i;
  unsigned int		j;

  if (!string || !arg)
    return (NULL);
  i = 0;  printf("ok\n");
  while (string->string[i])
    {
      if (string->string[i] == '%')
	{
	  j = 1;
	  while (string->string[i + j] <= '9' && string->string[i + j] >= '0')
	    j++;
	  if (j > 1 && string->string[i + j] == '$')
	    string = check_dollar(string, arg, i + 1);
	}
      i++;
    }
  return (string);
}
